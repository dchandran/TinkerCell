SET(LIBRARY_OUTPUT_PATH ${C_LIBRARY_OUTPUT_PATH})

OPTION( EMBED_OCTAVE "Embed Octave in TinkerCell" OFF )
FIND_PATH( OCTAVE_INCLUDE_DIR octave.h ${TINKERCELL_SOURCE_DIR}/octave )
FIND_LIBRARY( OCTAVE_CRUFT_LIBRARY NAMES cruft PATH  ${TINKERCELL_SOURCE_DIR}/octave)
FIND_LIBRARY( OCTAVE_OCTAVE_LIBRARY NAMES octave PATH  ${TINKERCELL_SOURCE_DIR}/octave)
FIND_LIBRARY( OCTAVE_OCTAVEINTERP_LIBRARY NAMES octinterp PATH  ${TINKERCELL_SOURCE_DIR}/octave)

IF(EMBED_OCTAVE AND OCTAVE_CRUFT_LIBRARY AND OCTAVE_OCTAVE_LIBRARY AND OCTAVE_OCTAVEINTERP_LIBRARY AND OCTAVE_INCLUDE_DIR)

   INCLUDE_DIRECTORIES( BEFORE ${OCTAVE_INCLUDE_DIR} )
   
   ADD_DEFINITIONS(-D__cplusplus)
   
   ADD_LIBRARY( tcoct
  	  SHARED
	  tinkercell_wrap.cpp
	  runoctave.cpp
  )
  
  #extend
  TARGET_LINK_LIBRARIES( tcoct
    tcoct
    tinkercellapi
    ${OCTAVE_CRUFT_LIBRARY}
    ${OCTAVE_OCTAVE_LIBRARY}
    ${OCTAVE_OCTAVEINTERP_LIBRARY}
  )
 
  #INSTALL(TARGETS tcoct DESTINATION octave)
  
  IF ( WIN32 )
    
    ADD_CUSTOM_COMMAND (
          TARGET tcoct POST_BUILD
          COMMAND copy "${TINKERCELL_BINARY_DIR}/bin/plugins/c/tcoct.dll" "${TINKERCELL_BINARY_DIR}/bin/octave/tinkercell.oct"
      )
    
    #ADD_CUSTOM_COMMAND (
    #      TARGET tcoct POST_BUILD
    #      COMMAND copy ${TINKERCELL_BINARY_DIR}/bin/plugins/c/tcoct.dll ${TINKERCELL_BINARY_DIR}/bin/octave/tcrunoct.dll
    #  )
    
  ELSE ( WIN32 )

    ADD_CUSTOM_COMMAND (
         TARGET tcoct POST_BUILD
         COMMAND cp ${TINKERCELL_BINARY_DIR}/bin/plugins/c/libtcoct.so ${TINKERCELL_BINARY_DIR}/bin/octave/tinkercell.oct
    )
    
    #ADD_CUSTOM_COMMAND (
    #      TARGET tcoct POST_BUILD
    #      COMMAND cp ${TINKERCELL_BINARY_DIR}/bin/plugins/c/libtcoct.so ${TINKERCELL_BINARY_DIR}/bin/octave/libtcoct.so
    #)
      
  ENDIF( WIN32 )
  
  FILE(GLOB OCTAVE_LOADER ${TINKERCELL_BINARY_DIR}/bin/octave/tinkercell.oct)
  FILE(GLOB OCTAVE_SCRIPTS *.m)

  INSTALL(FILES  ${OCTAVE_CRUFT_LIBRARY} ${OCTAVE_OCTAVE_LIBRARY} ${OCTAVE_OCTAVEINTERP_LIBRARY}
     DESTINATION octave
     COMPONENT Octave
  )
  INSTALL(FILES ${OCTAVE_SCRIPTS}
     DESTINATION octave
     COMPONENT Octave
   )
  INSTALL(FILES ${OCTAVE_LOADER}
     DESTINATION octave
     COMPONENT Octave
   )
ENDIF(EMBED_OCTAVE AND OCTAVE_CRUFT_LIBRARY AND OCTAVE_OCTAVE_LIBRARY AND OCTAVE_OCTAVEINTERP_LIBRARY AND OCTAVE_INCLUDE_DIR)

