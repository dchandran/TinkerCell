SET(LIBRARY_OUTPUT_PATH ${EXECUTABLE_OUTPUT_PATH}/octave)

OPTION( EMBED_OCTAVE "Embed Octave in TinkerCell" OFF )
FIND_PATH( OCTAVE_INCLUDE_DIR octave.h ${TINKERCELL_SOURCE_DIR}/octave )
FIND_LIBRARY( OCTAVE_CRUFT_LIBRARY NAMES cruft PATH  ${TINKERCELL_SOURCE_DIR}/octave)
FIND_LIBRARY( OCTAVE_OCTAVE_LIBRARY NAMES octave PATH  ${TINKERCELL_SOURCE_DIR}/octave)
FIND_LIBRARY( OCTAVE_OCTAVEINTERP_LIBRARY NAMES octinterp PATH  ${TINKERCELL_SOURCE_DIR}/octave)

IF(EMBED_OCTAVE AND OCTAVE_CRUFT_LIBRARY AND OCTAVE_OCTAVE_LIBRARY AND OCTAVE_OCTAVEINTERP_LIBRARY AND OCTAVE_INCLUDE_DIR)

   INCLUDE_DIRECTORIES( BEFORE ${OCTAVE_INCLUDE_DIR} )   
#  ADD_DEFINITIONS(-D__cplusplus)

  IF ( WIN32 )
      ADD_DEFINITIONS(-D_WIN32)
      ADD_DEFINITIONS(-DTCAPIEXPORT=)
      IF (MINGW)
         ADD_DEFINITIONS(-D__MINGW32__)
      ENDIF(MINGW)
  ENDIF( WIN32 )

   FILE(GLOB TCAPI_SRC ${TINKERCELL_SOURCE_DIR}/API/*.c)
   ADD_LIBRARY( tcoct
  	  SHARED
  	  runoctave.cpp
  	  tinkercell_wrap.cpp
 	  ${TCAPI_SRC}
  )
  #  extend
  ADD_LIBRARY( swigtcoct
  	  SHARED
        tinkercell_wrap.cpp
        ${TCAPI_SRC}
  )

 #embed
  TARGET_LINK_LIBRARIES( tcoct
    tcoct
    ${OCTAVE_CRUFT_LIBRARY}
    ${OCTAVE_OCTAVE_LIBRARY}
    ${OCTAVE_OCTAVEINTERP_LIBRARY}
  )

    TARGET_LINK_LIBRARIES( swigtcoct
    swigtcoct
    ${OCTAVE_CRUFT_LIBRARY}
    ${OCTAVE_OCTAVE_LIBRARY}
    ${OCTAVE_OCTAVEINTERP_LIBRARY}
  )
 
  INSTALL(TARGETS tcoct DESTINATION octave)
  
  IF ( WIN32 )    
    ADD_CUSTOM_COMMAND (
          TARGET swigtcoct POST_BUILD
          COMMAND move /Y ..\\bin\\octave\\libswigtcoct.dll ..\\bin\\octave\\tinkercell.oct
      )
  ELSE ( WIN32 )
  IF( APPLE )
    ADD_CUSTOM_COMMAND (
         TARGET swigtcoct POST_BUILD
         COMMAND cp ${TINKERCELL_BINARY_DIR}/bin/octave/libswigtcoct.dylib ${TINKERCELL_BINARY_DIR}/bin/octave/tinkercell.oct
    )
  ELSE ( APPLE )
    ADD_CUSTOM_COMMAND (
         TARGET swigtcoct POST_BUILD
         COMMAND cp ${TINKERCELL_BINARY_DIR}/bin/octave/libswigtcoct.so ${TINKERCELL_BINARY_DIR}/bin/octave/tinkercell.oct
    )
  ENDIF( APPLE )
  ENDIF( WIN32 )

  FILE(GLOB OCTAVE_LOADER ${TINKERCELL_BINARY_DIR}/bin/octave/tinkercell.oct)
  FILE(GLOB OCTAVE_SCRIPTS *.m)

  INSTALL(FILES ${OCTAVE_CRUFT_LIBRARY} ${OCTAVE_OCTAVE_LIBRARY} ${OCTAVE_OCTAVEINTERP_LIBRARY}
     DESTINATION octave
     COMPONENT Octave
  )

  INSTALL(FILES ${OCTAVE_SCRIPTS}
     DESTINATION octave
     COMPONENT Octave
   )
  INSTALL(FILES ${OCTAVE_LOADER}
     DESTINATION octave
     COMPONENT Octave
   )
ENDIF(EMBED_OCTAVE AND OCTAVE_CRUFT_LIBRARY AND OCTAVE_OCTAVE_LIBRARY AND OCTAVE_OCTAVEINTERP_LIBRARY AND OCTAVE_INCLUDE_DIR)

